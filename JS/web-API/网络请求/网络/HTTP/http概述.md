# http 概述

HTTP (超文本传输协议) 是一种能够获取 HTML 这样的网络资源的通讯协议.

是一种 `client-server` 协议, 请求通常由像浏览器这样的接受方发起.

客户端发出的消息叫做`request`, 服务器响应的消息叫做 `response`

它设计于 20 世纪 90 年代初期

它是应用层协议, 通过`TCP` 或 `TLS`加密的 TCP 连接来发送. 因为器良好的扩展性, 它还可以被用来传输图片, 视频, 表单这样的信息

## 基础 HTTP 的组件系统

HTTP 请求通过一个实体发出(也就是用户代理), 大多数时候是浏览器.

在请求与响应之间, 还会有很多的 proxies 的实体(代理服务器), 比如网关, nginx 等

## 客户端: user-agent

user-agent 就是任何能够为用户发起行为的工具。这个角色通常都是由浏览器来扮演。

## Web 服务器

在上述通信过程的另一端，是由 Web Server 来服务并提供客户端所请求的文档。Server 只是虚拟意义上代表一个机器：它可以是共享负载（负载均衡）的一组服务器组成的计算机集群，也可以是一种复杂的软件，通过向其他计算机（如缓存，数据库服务器，电子商务服务器 ...）发起请求来获取部分或全部资源。

Server 不一定是一台机器，但一个机器上可以装载的众多 Servers。在 HTTP/1.1 和 Host 头部中，它们甚至可以共享同一个 IP 地址。

## 代理

在浏览器和服务器之间，有许多计算机和其他设备转发了 HTTP 消息。由于 Web 栈层次结构的原因，它们大多都出现在传输层、网络层和物理层上，对于 HTTP 应用层而言就是透明的，虽然它们可能会对应用层性能有重要影响。还有一部分是表现在应用层上的，被称为代理（Proxies）

代理主要有如下作用:

- 缓存
- 过滤
- 负载均衡
- 认证(对不同资源进行权限管理)
- 日志记录

## HTTP 基本性质

- 简单的: HTTP 大体上还是被设计得简单易读.
- 可扩展: HTTP headers 让协议扩展变得非常容易。只要服务端和客户端就新 headers 达成语义一致，新功能就可以被轻松加入进来。
- 无状态, 有会话的:
  - HTTP 是无状态的：在同一个连接中，两个执行成功的请求之间是没有关系的。
  - 有会话: 值的是可以通过 Cookie 来携带共享信息, 达成相同的状态

## HTTP 和连接

在客户端（通常指浏览器）与服务器能够交互（客户端发起请求，服务器返回响应）之前，必须在这两者间建立一个 TCP 链接，打开一个 TCP 连接需要多次往返交换消息（因此耗时）。**HTTP/1.0 默认为每一对 HTTP 请求/响应都打开一个单独的 TCP 连接**。当需要连续发起多个请求时，这种模式比多个请求共享同一个 TCP 链接更低效。

为了减轻这些缺陷, `HTTP1.1`引入了持久连接的概念: **底层的 TCP 连接可以通过 Connection 头部来被部分控制。** HTTP/2 则发展得更远，通过在一个连接复用消息的方式来让这个连接始终保持为暖连接。

## HTTP 能控制什么

- 缓存
- 开放同源策略(CORS)
- 认证(Authenticate 和 Cookie)
- 代理和隧道
  - 通常情况下，服务器和/或客户端是处于内网的，对外网隐藏真实 IP 地址。因此 HTTP 请求就要通过代理越过这个网络屏障。但并非所有的代理都是 HTTP 代理。例如，SOCKS 协议的代理就运作在更底层，一些像 FTP 这样的协议也能够被它们处理。
- 会话
  - 使用 HTTP Cookies 允许你用一个服务端的状态发起请求，这就创建了会话。虽然基本的 HTTP 是无状态协议

## HTTP 流程

1. 打开一个 TCP 连接: 客户端可能打开一条新的连接，或重用一个已经存在的连接，或者也可能开几个新的 TCP 连接连向服务端。
2. 发送一个 HTTP 报文
3. 读取服务器返回的报文信息
4. 关闭连接或者为后续请求重用连接

当 HTTP 流水线启动时，后续请求都可以不用等待第一个请求的成功响应就被发送。然而 HTTP 流水线已被证明很难在现有的网络中实现，因为现有网络中有很多老旧的软件与现代版本的软件共存。因此，HTTP 流水线已被在有多请求下表现得更稳健的 HTTP/2 的帧所取代。


