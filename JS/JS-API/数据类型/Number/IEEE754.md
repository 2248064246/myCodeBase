# IEEE 754

IEEE 754(二进制浮点数算术标准), 是 20 世纪 80 年代以来最广泛使用的浮点数运算标准.

IEEE754 使用最多的两种浮点数表示方式是: 单精度(32 位), 双精度(64 位)

## IEEE 754 的 64 位双精度浮点规范

规范定义: 第 1 位为符号位(Sign), 后面 11 位为指数位(Exponent), 再后面 52 位为小数位(Fraction)

| 比特导长度 | 名称     | 比特编号 |
| ---------- | -------- | -------- |
| 1          | S        | 63       |
| 11         | Exp      | 62~52    |
| 52         | Fraction | 51 ~0    |

> 注意, 为了实现小数, 实数部分存在偏正值-- 2^(Exp-1)-1 = 1023. 实际的`Exp`值为指数位值减去偏正值, 所以 `Exp`取值范围为`[-1023, 1024]`

计算法则: `(-1)^S * (1|0.Fraction) * 2 ^ Exp`

注意这里的`S Fraction Exp` 都是二进制形式, 真正计算时需要转为 10 进制

## JS 中数值极值来源

### `Number.MAX_VALUE` 和 `Number.MIN_VALUE`

**最大正值**
此时`Exp= 2^11 -1 -1 - 1023 = 1023`

> 规范定义: Exp 前 10 位为 1, 最后一位为 0 时可以取得最大正值

```js
/**
 * 符号位 S 为 0
 * 指数位值为 1023
 * 整数位二进制为 1
 * 小数位二进制全为 1
 * 之所以重复53次是因为加上了整数位的 1, 要得到对应十进制小数值, 往后移动52位即可
 */
const MAX =
  (-1) ** 0 * 2 ** 1023 * (Number.parseInt('1'.repeat(53), 2) * 2 ** -52);
```

**最小正值**

此时 `Exp = 2^0 - 1023 = -1022`

> 规范定义: Exp 前 10 位为 0, 最后一位为 1 时可以取得最小正值

```js
/**
 * 符号位 S 为 0
 * 指数位值为 -1022
 * 整数位二进制 0
 * 小数位二进制最后一位为1
 */
const MIN =
  (-1) ** 0 *
  2 ** -1022 *
  (Number.parseInt('0'.repeat(52) + '1', 2) * 2 ** -52);
```

### `Number.MAX_SAFE_INTEGER` 和 `Number.MIN_SAFE_INTEGER`

将`Exp`设置为 52, 让每一位小数位都表示浮点数的整数部分, 由此得到最大安全整数, 对其取反得到最小安全整数

```js
const SAFE_MAX =
  (-1) ** 0 * 2 ** 52 * (Number.parseInt('1'.repeat(53), 2) * 2 ** -52);

const SAFE_MIN = -1 * SAFE_MAX;
```
