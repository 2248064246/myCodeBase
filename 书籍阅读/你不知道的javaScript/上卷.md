

# 你所不知道的javaScript上卷

[TOC]

## 作用域是什么

### 编译原理
> JS代码的编译发生在代码执行前的几微秒
+ 分词/词法分析
+ 解析/语法分析
  + AST语法树
+ 代码生成
  + 将AST转换为可执行代码

### 理解作用域
> 进行 var a = 2

+ 编译器处理过程 (`声明` 和 `赋值`)
  + 编译器会查询作用域中是否已经存在 `a`变量, 如果存在则忽略 `var a` 声明, 不存在则创建 `a` 变量
  + 接下来编译器会生成运行时代码来进行赋值操作, 然后会查找作用域中是否存在 `a`, 存在直接使用这个变量, 不存在会沿着作用域查找

+ 引擎是如何查找变量
  + LHS
    + 赋值查询, 需要将值赋值给变量
  + RHS
    + 取值查询, 只需要拿到变量的值
  + 他们的区别
    + RHS 如果没有找到会抛出 `ReferenceError`, 表示没有该变量的引用(该变量未找到)
    + LHS 如果没有找到, 引擎会自动帮你创建一个(一般是全局变量)
    ```javaScript
      function foo(a) {
        console.log(a + b) // 这里会抛出错误, b没有找到
        b = a // 这里会自动创建一个全局变量 b
      }
      foo(2)
    
    ```