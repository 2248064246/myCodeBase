
# 渲染页面--浏览器工作原理

## 概述

等待资源加载和JS的单线程执行时影响 Web性能的主要因素

## 导航

导航是加载 Web 页面的第一步. 一下情况触发导航: 在地址栏输入 url 并 enter, 点击一个链接, 提交一个表单, JS 代码调用 Widow.open API 或者其他

### DNS 查找

导航的第一步是去寻找页面资源位置

浏览器通过服务器名称请求DNS查找, 最终返回一个ip地址

如果 js, img, font 等资源的主机地址不通, 也需要请求 DNS

DNS 对于性能来说是一个问题, 尤其是移动网络(需要经过信号塔 - 运行商 - DNS)

+ DNS 查询原理
+ DNS 缓存

### TCP 连接

获取了IP地址之后, 浏览器就会通过 TCP 与服务器建立连接

+ TCP 三次握手, 四次挥手

### TLS 协商

为了在 HTTPS 上建立安全连接, TLS 是必须得, 协商服务器和客户端使用什么加密解密方法

## 响应

一旦与服务器连接, 浏览器就发送了一个初始 http get 请求, 对网站来说通常是 HTML 文件

### TCP慢开始 / 14kb 规则

第一个响应包是 14kb 大小. 这是慢开始的一部分, 慢开始是一种均衡网络连接速度的算法.

慢开始逐渐增加发送数据的数量, 直到达到网络的最大带宽

### 拥塞控制

当服务器用TCP包来发送数据时，客户端通过返回确认帧来确认传输。由于硬件和网络条件，连接的容量是有限的。 如果服务器太快地发送太多的包，它们可能会被丢弃。意味着，将不会有确认帧的返回。服务器把它们当做确认帧丢失。拥塞控制算法使用这个发送包和确认帧流来确定发送速率。

## 解析

一旦浏览器收到数据的第一块, 它就可以开始解析收到的信息. 

解析是指: 将接收到的数据转为 DOM 和 CSSOM 的步骤, 通过渲染器把 DOM 和 CSSOM 绘制到屏幕上

即使请求页面的 HTML 大于初始的 14kb, 浏览器也将开始解析并尝试根据其拥有的数据进行渲染

保证第一个渲染的 HTML 小于 14kb 是重要的

但是在渲染到屏幕上之前, HTML CSS JavaScript 必须被解析完成

### 构建DOM输



## 渲染

## 交互