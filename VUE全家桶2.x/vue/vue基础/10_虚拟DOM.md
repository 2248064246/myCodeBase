# 虚拟 DOM

一个用 JS 对象描述的 DOM 结构, 彼此之间一一对应.

在数据变化的时候, 先检索和修改虚拟 DOM, 在通过这个虚拟 DOM 应用在真实的 DOM 上, 减少操作 DOM 的次数 (操作 DOM 可能会引起浏览器的重绘, 频繁操作会导致页面闪烁, 卡顿)

> 虚拟 dom 可以很好的跟踪当前 dom 状态，因为他会根据当前数据生成一个描述当前 dom 结构的虚拟 dom，然后数据发送变化时，又会生成一个新的虚拟 dom，而这两个虚拟 dom 恰恰保存了变化前后的状态。然后通过 diff 算法，计算出两个前后两个虚拟 dom 之间的差异，得出一个更新的最优方法（哪些发生改变，就更新哪些）。可以很明显的提升渲染效率以及用户体验

## 如何实现虚拟 DOM

有那么一点点复杂

## 虚拟 DOM 的 Diff 算法

> diff 算法就是用于比较新旧两个虚拟 dom 之间差异的一种算法。

**diff 比较两个虚拟 dom 只会在同层级之间进行比较，不会跨层级进行比较(层序遍历)**

**比较同层节点的时候,使用先序遍历依次比较字节点**

### diff 比较整体思路

1. 先比较两个虚拟 DOM 根节点是否相同
2. 在对比同层两个子节点是否相同
3. 如果这两个子节点都存在子节点, 需要深度对比子节点

> 里面还有更加复杂的玩意...

## diff 和数据劫持工作原理

diff 算法就能精确知道变动的 DOM 节点, 然后更新. 但是当 DOM 结构很复杂的时候, 性能就会出现下降.

Vue 的解决方法是通过数据劫持来知道 DOM 变化发生在哪个组件, 然后通知对应组件进行 diff.
