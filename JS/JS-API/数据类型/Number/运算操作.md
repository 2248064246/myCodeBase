# 运算操作

JS 中的算术遇到 上溢出, 下溢出, 除以0 时, 不会发生错误

在数值超过最大可表示数时, 结果是一个 `Infinity` 无穷值

基本的 `+ - * / %` 操作并不是这里主要的关注点.

主要注意 `位运算` 以及它们和普通运算的差异

## 位运算

> 二进制运算都是按照`补码形式参与运算的`

位操作符期待整数操作数, 而且将他们当成 32 整数而不是 64 位浮点数

然后在将得到的数值**强制转换为 32 位数, 丢弃小数部分和第 32 位以外的部分**

## & | ^ ~

- & 按位与
  ```js
    // & 与运算
    0&0=0;  0&1=0;   1&0=0;    1&1=1;
  ```
- | 按位或
  ```js
    // | 或运算
    0|0=0;  0|1=1;  1|0=1;   1|1=1;
    // 有一种用法是使用或运算来去除小数(只保留整数部分)
    0 | 1.89 // => 1 类似Math.ceil(), 但是只能正对32位整数
  ```
- ^ 按位异或
  ```js
    // ^ 异或运算
    0^0=0;  0^1=1;  1^0=1;   1^1=0;
  ```
- ~ 按位非

  ```js
  // ~ 是取反(对二进制取反)操作
  ~6; // => -7 这里会等于 -7 的原因是 6的源码取反之后在转为10进制输出的问题

  // 6 -> 00000110(补码) -> 取反 -> 11111001(补码) -> 转10进制 -> 先将补码-1 -> 11111000 -> 补码转原码 -> 符号位不变, 其余取反 -> 10000111 -> 结果是 -7

  // 取反的一个用是用于判断 -1(程序标志位)
  ~'abc'.indexOf('x'); // 如果是在此时不需要 === -1, 因为它的结果是 0
  ```

| 运算符           | 用法    | 描述                                                                |
| ---------------- | ------- | ------------------------------------------------------------------- | --- | --------------------------------------------------------- |
| `&` 与           | `a & b` | 对于一个二进制数字，二者都为 1 时，结果为 1，否则为 0               |
| `                | ` 或    | `a                                                                  | b`  | 对于一个二进制数字，至少有一个为 1 时，结果为 1，否则为 0 |
| `^` 异或         | `a^b`   | 对于一个二进制数字，有且只有一个为 1 时，结果为 1，否则为 0         |
| `~` 非           | `~a`    | 翻转二进制数字，即 0 变成 1，1 变成 0                               |
| `<<` 左移        | `a<<b`  | 将 a 的二进制形式向左移动 b（<32）位，右边用 0 填充                 |
| `>>` 有符号右移  | `a>>b`  | 将 a 的二进制表示向右移动 b（<32）位，丢弃被移出的位                |
| `>>>` 无符号右移 | `a>>>b` | 将 a 的二进制表示向右移动 b（<32）位，丢弃被移出的位，左边用 0 填充 |

**一些骚操作**

> 注意只适用于小于 32 位及以下的数

- 通过 `^` 完成交换

> 原理是 一个数异或两个相同的数不变(两个相等的数异或为 0, 一个数和 0 异或是自己本身)

```js
let a = 7;
let b = 1;
a ^= b;
b ^= a;
a ^= b;
```

这个原理还可用来计算数组中只出现一次的值

```js
[1, 2, 3, 2, 1].reduce((r, c) => (r ^= c));
```

- 取整(向下取整)

```js
~~1.23;
1.23 | 0;
1.23 >> 0;
```

- 判断是否为 2 的整数幂

```js
n & (n - 1)  === 0; // 应为如果是2的整数幂, 其值减一后 & 原来值刚好为 0
```

- 奇偶性判断
> 二进制特性: 第一个数是1就是奇数, 是0就是偶数
```js
n & 1; // 为 1 是奇数, 为 0 是偶数
```
- 快速计算2的次方
```js
1 << n; 
1 << 10; // 1024
```

- 判断两个数符号是否相同
```js
if(a ^ b >= 0) 符号相同
else 符号不相同
```
