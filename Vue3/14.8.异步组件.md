# 异步组件

> 在大型项目中，我们可能需要拆分应用为更小的块，并仅在需要时再从服务器加载相关组件。

Vue 提供了 `defineAsyncComponent()` 方法来实现这个功能

```js
import { defineAsyncComponent } from 'vue';

const AsyncComp = defineAsyncComponent(() => {
  return new Promise((resolve, reject) => {
    // ...从服务器获取组件
    resolve(/* 获取到的组件 */);
  });
});
// ... 像使用其他一般组件一样使用 `AsyncComp`
```

`ES模块动态导入-- import()`也会返回一个 promise, 多数情况下可以将他们和 `defineAsyncComponent()`搭配使用. 并且 vite 和 webpack 这种构建工具也支持这种语法(而且会作为打包时的代码分割点), 因此也可以用这种方法来导入 Vue 单文件组件

```js
import { defineAsyncComponent } from 'vue';

const AsyncComp = defineAsyncComponent(() =>
  import('./components/MyComponent.vue')
);
```

这种组件只会在需要它的页面才会加载并调用.

与普通组件一样, 异步组件也可以在全局注册

```js
app.component(
  'MyComponent',
  defineAsyncComponent(() => import('./components/MyComponent.vue'))
);
```

或者在局部组件注册

```html
<script>
  import { defineAsyncComponent } from 'vue';

  export default {
    components: {
      AdminPage: defineAsyncComponent(() =>
        import('./components/AdminPageComponent.vue')
      ),
    },
  };
</script>

<template>
  <AdminPage />
</template>
```

## 加载和错误

> 这个 Vue2 貌似没有

`defineAsyncComponent()` 提供了对于异步加载错误的处理

```js
const AsyncComp = defineAsyncComponent({
  // 加载函数
  loader: () => import('./Foo.vue'),

  // 加载异步组件时使用的组件
  loadingComponent: LoadingComponent,
  // 展示加载组件前的延迟时间，默认为 200ms
  delay: 200,

  // 加载失败后展示的组件
  errorComponent: ErrorComponent,
  // 如果提供了一个 timeout 时间限制，并超时了
  // 也会显示这里配置的报错组件，默认值是：Infinity
  timeout: 3000,
});
```

如果提供了一个加载组件，它将在内部组件加载时先行显示。在加载组件显示之前有一个默认的 200ms 延迟——这是因为在网络状况较好时，加载完成得很快，加载组件和最终组件之间的替换太快可能产生闪烁，反而影响用户感受。

如果提供了一个报错组件，则它会在加载器函数返回的 Promise 抛错时被渲染。你还可以指定一个超时时间，在请求耗时超过指定时间时也会渲染报错组件。

## 搭配 Suspense 使用

这是 Vue3 的东西了, Vue2 不存在
