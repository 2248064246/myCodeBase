
# async 和 await

ES2017新增两个关键字: async和await, 代表异步JS编程范式的迁移 (编程范式是程序员看待程序应该具有的观点，代表了程序设计者认为程序应该如何被构建和执行的看法。)

这两个关键字极大的简化了期约的使用, 并让代码看起来像同步代码一样易于理解和推理


## await

await 接收一个期约, 并将其转换为一个返回值或一个抛出的异常, await会一直等待期约`落定`

代码依旧是异步的, 而await只是掩盖了这个事实, (任何使用 await 的代码本身都是异步的)

## async 函数

只能在 async 声明的函数内部使用 await 关键字

把函数声明为 async 意味着函数的返回值将会是一个期约, 如果函数返回正常值, 则会包装为期约, 如果抛出异常, 则抛出异常的期约

### async 实现原理

async 函数本质上是基于期约的

例如有这个一个async函数
```js
async function f(x){ /* 函数体 */}
```

可以把它理解为这种样子
```js
function f(x) {
  return new Promise((resolve, reject) => {
    try{
      resolve((function(x){/* 函数体 */})(x))
    } catch(e) {
      reject(e)
    }
  })
}
```

但是这种形式要解释 await 比较困难. 

可以把await关键字想象成分隔代码体的记号, 它们把函数体分割成相对独立的同步代码块. ES2017解释器可以把函数体分隔成一系列的独立子函数, 每个子函数都将传给它前面的以await标记的那个期约的then()方法
