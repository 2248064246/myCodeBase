# 隧道伪装

## udp2raw

查看 `ssr速度提升`章节

## Cloak

用来防止数据被标记，审查。

它将代理工具的流量伪装成正常的网页浏览流量

> 特别说明: 对于单核 vps, 在开启 bbr 的情况下, 速度相比 kcptun 慢了近 10 倍... 不明白是什么原因导致(可能对单核 vps 不友好吧)

> 注意: 此服务需要 80 和 443 端口, 如果连不上可能需要给与此服务这两个端口的权限

[项目地址](https://github.com/cbeuw/Cloak#server)

**build**

```shell
git clone https://github.com/cbeuw/Cloak
cd Cloak
go get ./...
make
```

可执行文件在 `build` 下面, 里面会有一个 `client` 和 一个 `server` 文件

**服务端**

1. 执行 `ck-server -key` 生成密钥对.
2. 执行 `ck-server -uid` 生成一个用于 id, 此 id 用于 admin 用户
3. 创建和编辑 `ckserver.json` 文件, 写入如下数据
   ```json
   {
     "ProxyBook": {
       /* 需要代理的服务 */
       "shadowsocks": ["tcp", "0.0.0.0:9090"]
     },
     /* 此服务绑定的端口 */
     "BindAddr": [":443", ":80"],
     /* 允许连接的用户ID */
     "BypassUID": [],
     /* 没有授权的用户连接会重定向到此地址 */
     "RedirAddr": "www.bing.com",
     /* 私钥 */
     "PrivateKey": "wLb3zozm75hXx5va4K0DXCfM0clqe3wpr6LnFb8bZHM=",
     /* 管理员id */
     "AdminUID": "97f43AwK0lt/+sKH6Pv6EA==",
     /* 数据库 (不需要手动创建, 会自动在当前执行目录下创建一个) */
     "DatabasePath": "userinfo.db"
   }
   ```
4. 启动 `./ck-server -c /etc/cloak/ckserver.json `

**客户端**

1. 创建 `ckclient.json` 文件, 写入如下数据
   ```json
   {
     "Transport": "direct",
     /* 这里需要和服务端的 ProxyBook 中的某一项匹配 */
     "ProxyMethod": "shadowsocks",
     /* 加密方法, 支持 plain aes-gcm aes-128-gcm chacha20-poly1305 */
     "EncryptionMethod": "aes-gcm",
     /* 用户ID */
     "UID": "",
     /* 私钥 */
     "PublicKey": "iazrFAM2Hbfn+aK3up6Uj/6Y+LEaYuS0jFTge6+g4lA=",
     /* 伪装网址(最好和服务端的 RedirAddr 相同) */
     "ServerName": "www.bing.com",
     "NumConn": 4,
     "BrowserSig": "chrome",
     "StreamTimeout": 3000,
     "KeepAlive": 1
   }
   ```
2. 先连接管理员, 创建用户
   ```shell
    ./ck-client -c /etc/cloak/ckclient.json -s ssr.luoshuifushen.cn -l 55566 -a 97f43AwK0lt/+sKH6Pv6EA==
    # -s 服务端地址
    # -l 监听的本地端口
    # -a admin ID
   ```
3. 通过`https://cbeuw.github.io/Cloak-panel` 这个地址, 写入 `127.0.0.1:55566`. 点击 `list` 按钮会出现 `+` 面板, 通过这个面板创建用户.

   注意这个面板的所有数据都是必填.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **也可以跳过此步骤, 直接通过 `ck-server -uid` 直接生成用户 id**

4. 将生成的用户 id 分别写入服务端的 `BypassUID` 和 客户端的 `UID`
5. 重启服务端, 重启客户端(此时不需要提供 adminID `./ck-client -c /etc/cloak/ckclient.json -s ssr.luoshuifushen.cn -l 55566`)


