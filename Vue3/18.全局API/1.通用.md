# 通用全局 API

## version

获取当前 Vue 版本

```js
import { version } from 'vue';

console.log(version);
```

## nextTick

Vue2 中需要传递回调函数个 nextTick, Vue3 也支持, 但是还支持一下方法

Vue3 中 `nextTick` 返回一个 promise

```js
export default {
  methods: {
    async increment() {
      this.count++;

      // DOM 还未更新
      console.log(document.getElementById('counter').textContent); // 0

      await nextTick();
      // DOM 此时已经更新
      console.log(document.getElementById('counter').textContent); // 1
    },
  },
};
```

## defineComponent

为了让 TypeScript 正确地推导出组件选项内的类型，我们需要通过 defineComponent() 这个全局 API 来定义组件：

```ts
import { defineComponent } from 'vue';

export default defineComponent({
  // 启用了类型推导
  props: {
    name: String,
    msg: { type: String, required: true },
  },
  data() {
    return {
      count: 1,
    };
  },
  mounted() {
    this.name; // 类型：string | undefined
    this.msg; // 类型：string
    this.count; // 类型：number
  },
});
```

## defineAsyncComponent

定义一个异步组件, 它在运行时是懒加载的

```ts
function defineAsyncComponent(
  source: AsyncComponentLoader | AsyncComponentOptions
): Component;

type AsyncComponentLoader = () => Promise<Component>;

interface AsyncComponentOptions {
  loader: AsyncComponentLoader;
  loadingComponent?: Component;
  errorComponent?: Component;
  delay?: number;
  timeout?: number;
  suspensible?: boolean;
  onError?: (
    error: Error,
    retry: () => void,
    fail: () => void,
    attempts: number
  ) => any;
}
```

## defineCustomElement

定义自定义的 DOM 组件 (是 DOM 组件, 不是 Vue 组件)

需要使用 `customElements.define()` 来注册使用

```js
import { defineCustomElement } from 'vue';

const MyVueElement = defineCustomElement({
  /* 组件选项 */
});

// 注册自定义元素
customElements.define('my-vue-element', MyVueElement);
```

> 注意 组件选项中额外支持 `styles`, 它应该是一个内联 CSS 字符串的数组，所提供的 CSS 会被注入到该元素的 shadow root 上。
