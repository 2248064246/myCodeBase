# 核心概念

核心概念和 `useReducer` Hook 一模一样

```js
import { configureStore } from '@reduxjs/toolkit';

const initialState = { value: 0 };

function counterReducer(state = initialState, action) {
  // 检查 reducer 是否关心这个 action
  if (action.type === 'counter/increment') {
    // 如果是，复制 `state`
    return {
      ...state,
      // 使用新值更新 state 副本
      value: state.value + 1,
    };
  }
  // 返回原来的 state 不变
  return state;
}

// store 是通过传入一个 reducer 来创建的，并且有一个名为 getState 的方法，它返回当前状态值：
const store = configureStore({ reducer: counterReducer });

console.log(store.getState());

// Redux store 有一个方法叫 dispatch。更新 state 的唯一方法是调用 store.dispatch() 并传入一个 action 对象
// action 是一个具有 type 字段的普通 JavaScript 对象。你可以将 action 视为描述应用程序中发生了什么的事件.
store.dispatch({ type: 'counter/increment' });

console.log(store.getState());
// {value: 1}
```

## 术语

### 不可变性 immutablility

**不可变性** -- 不直接修改对象, 而是先克隆一份然后修改这个克隆对象.

Redux 期望所有状态更新都是使用不可变的方式.

### Action

action 是一个具有 type 字段的普通 JavaScript 对象。你可以将 action 视为描述应用程序中发生了什么的事件.

```js
const addTodoAction = {
  type: 'todos/todoAdded',
  payload: 'Buy milk',
};
```

`type` 是一个描述性名字, 类似是什么组件执行什么操作.
`payload` 是这个操作的数据载体

### Reducer

reducer 是一个函数, 接收当前的`state` 和一个`action` 对象, 必要时决定如何更新状态, 并返回新状态.

reducer 必须符合一下规则:

- 仅使用 `state` 和 `action` 参数计算新的状态值
- 禁止直接修改`state`, 必须通过赋值现有的`state`来达到不可变更新
- 禁止任何异步逻辑, 依赖随机值或导致其它副作用的代码(redux 需要可预测)

reducer 函数内部的逻辑通常遵循以下步骤：

- 检查 reducer 是否关心这个 action
  - 如果是，则复制 state，使用新值更新 state 副本，然后返回新 state
- 否则，返回原来的 state 不变


### Store

当前 Redux 应用的 state 存在于一个名为 store的对象中.

### Dispatch

store 上的一个方法, 通过传入 action 来更新 state, 这是更新 state 的唯一方法.

**dispatch 一个 action 可以形象的理解为 "触发一个事件"。**

### Selector

selector 函数可以从 store 状态树中提取指定的片段. 

## Redux 数据流

+ State 描述了应用程序在特定时间点的状况
+ 基于 state 来渲染视图
+ 当发生某些事情时（例如用户单击按钮），state 会根据发生的事情进行更新
  + 视图 dispatch 一个 action
  + store 调用 reducer，随后根据发生的事情来更新 state
  + store 将 state 发生了变化的情况通知 UI
+ 基于新的 state 重新渲染视图

![](https://cn.redux.js.org/assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif)


## 何时应该使用 Redux

全局状态应该放在 Redux store 中, 本地状态应该保留在 React 组件中

大多数表单的state不应该保存在redux中.


