## 预渲染

两种形式的预渲染: `静态生成` 和 `服务端渲染`

- 静态生成: HTML 在构建时就已经生成
- 服务端渲染: HTML 在每次页面请求时生成

Next.js 允许同时使用两种方式, 可以创建一个`混合渲染`, 大多数页面使用静态生成, 少数特殊页面使用服务端渲染

还可将`客户端渲染`与静态生成或服务端渲染一起使用.

## 静态生成

在 Next.js 中, 可以静态生成`带有或不带有数据`的页面

### 生成不带有数据的静态页面

默认情况下, Next.js 使用 `静态生成`来预渲染页面但是不涉及获取数据.

**(注意: 需要页面在预渲染时不需要获取任何外部数据)**

### 需要获取数据的静态生成

有些页面需要获取外部数据以进行预渲染. 有两种情况

1. 页面内容取决于外部数据: 使用`getStaticProps`
2. 页面`paths`取决于外部数据: 使用 `getStaticPaths` (通常还需要同时使用 `getStaticProps`)

**页面内容取决于外部数据**

Next.js 允许在同一个文件中导出一个名为`getStaticProps` 的 `async` 函数. 该函数在构建时被调用, 并允许在预渲染时将获取的数据作为`props`参数传递给页面

```js
function Blog({ posts }) {
  // Render posts...
}

// 此函数在构建时被调用
export async function getStaticProps() {
  // 调用外部 API 获取博文列表
  const res = await fetch('https://.../posts');
  const posts = await res.json();

  // 通过返回 { props: { posts } } 对象，Blog 组件
  // 在构建时将接收到 `posts` 参数
  return {
    props: {
      posts,
    },
  };
}

export default Blog;
```

**页面路径取决于外部数据**

这个通常用来创建动态路由页面.

例如数据库中目前有`id:1, id:2` 两条数据. 此时希望通过数据来创建页面.

此时, 预渲染的页面 paths（路径） 取决于外部数据。

Next.js 通过 export 一个名为`getStaticPaths` 的`async` 函数, 该函数在构建时被调用, 并允许指定要预渲染的路径

```js
// 此函数在构建时被调用
export async function getStaticPaths() {
  // 调用外部 API 获取博文列表
  const res = await fetch('https://.../posts');
  const posts = await res.json();

  // 据博文列表生成所有需要预渲染的路径
  const paths = posts.map((post) => ({
    params: { id: post.id },
  }));

  // We'll pre-render only these paths at build time.
  // { fallback: false } means other routes should 404.
  return { paths, fallback: false };
}
```

然后还可通过 export `getStaticProps` 来通过`id`获取数据并渲染

```js
function Post({ post }) {
  // Render post...
}

export async function getStaticPaths() {
  // ...
}

// 在构建时也会被调用
export async function getStaticProps({ params }) {
  // params 包含此片博文的 `id` 信息。
  // 如果路由是 /posts/1，那么 params.id 就是 1
  const res = await fetch(`https://.../posts/${params.id}`);
  const post = await res.json();

  // 通过 props 参数向页面传递博文的数据
  return { props: { post } };
}

export default Post;
```

## 什么时候应该使用 静态生成

通常来说, 下面类型的页面适合静态生成:

- 营销页面
- 博客和个人简历
- 电商产品列表
- 帮助和文档

## 服务端渲染

要对 page 使用服务单渲染, 需要 export 一个名为`getServerSideProps` 的`async` 函数, 服务器在每次页面请求时调用此函数.

```js
function Page({ data }) {
  // Render data...
}

// This gets called on every request
export async function getServerSideProps() {
  // Fetch data from external API
  const res = await fetch(`https://.../data`);
  const data = await res.json();

  // Pass data to the page via props
  return { props: { data } };
}

export default Page;
```


